!function(){function a(a){var b=[];for(var c in a){var d={label:c,value:a[c]};b.push(d)}return b}function b(a,b){var c=d3.select(a).style("width").replace("px","")/1.5,d=c,e=d3.scale.ordinal().range(p),f=d3.select(a).append("svg").attr("width",c).attr("height",d),g=f.append("g").attr("transform","translate("+c/2+","+d/2+")"),h=d3.svg.arc().innerRadius(0).outerRadius(c/2),i=d3.layout.pie().value(function(a){return a.value}),j=g.selectAll(".arc").data(i(b)).enter().append("g").attr("class","arc");j.append("path").attr("d",h).attr("fill",function(a,b){return e(b)}).style("opacity",0).transition().duration(v).style("opacity",1),j.append("text").attr("transform",function(a){return"translate("+h.centroid(a)+")"}).attr("text-anchor","middle").attr("font-size","1.5em").text(function(a){return s[a.data.label]+" ( "+a.data.value+" )"})}function c(a,b){var c=d3.select(a).style("width").replace("px","")/1.5,d=c,e=d3.scale.ordinal().range(p),f=d3.select(a).append("svg").attr("width",c).attr("height",d),g=f.append("g").attr("transform","translate("+c/2+","+d/2+")"),h=d3.svg.arc().innerRadius(c/4).outerRadius(c/2),i=d3.layout.pie().value(function(a){return a.value}),j=g.selectAll(".arc").data(i(b)).enter().append("g").attr("class","arc");j.append("path").attr("d",h).attr("fill",function(a,b){return e(b)}).style("opacity",0).transition().duration(v).style("opacity",1),j.append("text").attr("transform",function(a){return"translate("+h.centroid(a)+")"}).attr("text-anchor","middle").attr("font-size","1.5em").text(function(a){return t[a.data.label]})}function d(a,b){for(var c=d3.layout.histogram().bins(5)(b),d=[],e=0;e<c.length;e++)d.push(c[e].length);var f=d3.select(a).style("width").replace("px","")/1.5,g=.9*f,h=f,i=.9*h,j=g/5,k=d3.scale.ordinal().range(p),l=d3.select(a).append("svg").attr("width",f).attr("height",h),m=d3.scale.linear().domain([Math.min.apply(null,b),Math.max.apply(null,b)]).range([0,g]),n=d3.scale.linear().domain([0,Math.max.apply(null,d)]).range([0,.9*i]),o=d3.svg.axis().scale(m).orient("bottom");l.append("g").attr("class","axis").attr("transform","translate("+.05*f+","+.9*h+")").call(o);var q=l.selectAll(".bar").data(c).enter().append("g").attr("transform","translate("+.05*f+",0)").attr("class","bar");q.append("rect").attr("x",function(a){return m(a.x)}).attr("y",function(){return i}).transition().duration(v).attr("y",function(a){return i-n(a.length)}).attr("width",j).attr("height",function(a){return n(a.length)}).attr("fill",function(a,b){return k(b)}),q.append("text").attr("x",function(a){return m(a.x)+g/10}).attr("y",function(a){return i-n(a.length)}).text(function(a){return a.length}).style("opacity",0).transition().duration(v).style("opacity",1)}function e(a,b){var c=d3.select(a).style("width").replace("px","")/1.5,d=c,e=d3.scale.ordinal().range(p),f=d3.layout.pack().sort(null).size([d,d]).padding(1.5),g=d3.select(a).append("svg").attr("width",d).attr("height",d).attr("class","bubble"),h=g.selectAll(".node").data(f.nodes({children:b})).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+a.x+","+a.y+")"});h.append("title").text(function(a){return a.label}),h.append("circle").style("fill",function(a,b){return e(b)}).attr("r",0).transition().duration(v).attr("r",function(a){return a.r}),h.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(a){return a.label})}function f(a,b){var c=d3.select(a).style("width").replace("px","")/1.5,d=240,e={top:20,right:10,bottom:30,left:40},f=c-e.left-e.right,g=d-e.top-e.bottom,h=d3.scale.ordinal().rangeRoundBands([0,f],.1),i=d3.scale.linear().rangeRound([g,0]),j=d3.scale.ordinal().range(p),k=d3.svg.axis().scale(h).orient("bottom"),l=d3.svg.axis().scale(i).orient("left").tickFormat(d3.format(".2s")),m=d3.select(a).append("svg").attr("width",f+e.left+e.right).attr("height",g+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");h.domain(b.map(function(a){return a.label})),i.domain([0,d3.max(b,function(a){return a.value.M+a.value.F})]);var n=b.map(function(a){return{label:a.label,value:[{name:"Male",y0:0,y1:a.value.M},{name:"Female",y0:a.value.M,y1:a.value.M+a.value.F}]}});m.append("g").attr("class","xaxis").attr("transform","translate(0,"+g+")").call(k),m.append("g").attr("class","yaxis").call(l).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end");var o=m.selectAll(".department").data(n).enter().append("g").attr("class","department").attr("transform",function(a){return"translate("+h(a.label)+",0)"});o.selectAll("rect").data(function(a){return console.log(a),a.value}).enter().append("rect").attr("width",h.rangeBand()).attr("y",function(){return i(0)}).transition().duration(v).attr("y",function(a){return i(a.y1)}).attr("height",function(a){return i(a.y0)-i(a.y1)}).style("fill",function(a){return j(a.name)});var q=m.selectAll(".legend").data(j.domain().slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"});q.append("rect").attr("x",f-18).attr("width",18).attr("height",18).style("fill",j),q.append("text").attr("x",f-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a})}function g(b){for(var c={},d={},e=[],f={},g={},h=0;h<b.length;h++){if(void 0!==b[h].gender&&(void 0!==c[b[h].gender]?c[b[h].gender]+=1:c[b[h].gender]=1),void 0!==d[b[h].ethnicity]?d[b[h].ethnicity]+=1:d[b[h].ethnicity]=1,void 0!==b[h].qualifications)for(var i=0;i<b[h].qualifications.length;i++)"SAT"===b[h].qualifications[i].name&&e.push(b[h].qualifications[i].score);if(void 0!==b[h].departments)for(var j=0;j<b[h].departments.length;j++){var k=b[h].departments[j].department.name;void 0!==f[k]?f[k]+=1:f[k]=1,void 0===g[k]&&(g[k]={M:0,F:0}),void 0!==b[h].gender&&(g[k][b[h].gender]+=1)}}return{genderList:a(c),ethnicityList:a(d),satScoresList:e,departmentCandidateList:a(f),departmentGenderList:a(g)}}function h(a){function h(){var a=g(j);console.log(a.departmentGenderList),b(".student-gender-chart",a.genderList),c(".student-enthnicty-chart",a.ethnicityList),d(".student-scores-chart",a.satScoresList),e(".student-departments-chart",a.departmentCandidateList),f(".department-gender-chart",a.departmentGenderList),d3.select(".main").style("z-index","1"),d3.select(".loading").style("display","none")}function i(a){d3.select(".main").style("z-index","-1"),d3.select(".loading").style("display","block"),d3.json(a,function(a){j=j.concat(a.objects),void 0!==a.meta&&void 0!==a.meta.next&&null!==a.meta.next?(next_url=q+a.meta.next,i(next_url)):h()})}var j=[],k="&admission_year="+a,l=r+k;i(l)}var i="#2ecc71",j="#2c3e50",k="#e74c3c",l="#8e44ad",m="#16a085",n="#3498db",o="#f1c40f",p=[j,i,k,m,n,o,l],q="",r=q+"/api/v1/candidate/?format=json",s={M:"Male",F:"Female"},t={H:"Hispanic",A:"Asian",AA:"African-American",AP:"Asian/Pacific Islanders",C:"Caucasian",O:"Other"},u=2014,v=800;d3.select("select").on("change",function(){var a=parseInt(this.options[this.options.selectedIndex].label);d3.selectAll("svg").remove(),h(a)}),h(u)}();